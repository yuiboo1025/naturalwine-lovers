<!-- ナチュール記録ボタン -->
<%= render 'public/wines/post_wine-btn' %>

<div class="container my-4">

  <div class="row mr-5">
    <div class="col text-center mr-5">
      <% provide(:title,'ユーザー検索') %>
      <h4><%= title %></h4>
    </div>
  </div>

  <div class="row">
    <div class="col-sm-md">
      <%= render 'public/members/search_form', q: q, url: url %>
    </div>
  </div>

  <div class="row my-4 text-center">
    <div class="col-sm-md">

      <% unless members.empty? %>

      <table class="table member_index_table">
        <thead>
          <th>ユーザー名</th>
          <th>在住県</th>
          <th>好きなワインのジャンル</th>
          <th>ナチュール記録数</th>
          <th>フォロー数</th>
          <th>フォロワー数</th>
          <th></th>
        </thead>
        <% members.each do |member| %>
        <tbody>
          <tr>
            <td class="member_index_tbody_td" data-href="../../wines/myindex/<%= member.id%>">
              <%#= link_to wines_myindex_path(member) do %>
                <%= image_tag member.get_profile_image(60,60), class: "rounded-circle" %>
                <%= member.name %>
              <%# end %>
            </td>
            <td class="member_index_tbody_td" data-href="../../wines/myindex/<%= member.id%>"><%= member.prefecture %></td>
            <td class="member_index_tbody_td" data-href="../../wines/myindex/<%= member.id%>"><%= member.favorite_genre %></td>
            <td class="member_index_tbody_td" data-href="../../wines/myindex/<%= member.id%>"><%= member.wines.count %></td>
          <%# フォロー数、フォロワー数、フォローボタンを非同期化 %>
            <td class="member_index_tbody_td" data-href="../../wines/myindex/<%= member.id%>">
              <div class="followings_count-<%= member.id %>">
                <%= render "public/relationships/followings_counter", member: member %>
              </div>
            </td>
            <td class="member_index_tbody_td" data-href="../../wines/myindex/<%= member.id%>">
              <div class="followers_count-<%= member.id %>">
                <%= render "public/relationships/followers_counter", member: member %>
              </div>
            </td>
            <td class="relationships_btn-<%= member.id %>">
              <%= render 'public/relationships/relationship', member: member %>
            </td>
          </tr>
        </tbody>
        <% end %>
      </table>

      <% else %>
      <p>
      ユーザーが見つかりませんでした。<br>
      お探しのユーザー名を確認してください。
      </p>
      <% end %>

    </div>
  </div>

  <div class="d-flex justify-content-center">
     <%= paginate members, theme: 'bootstrap-5' %>
  </div>

</div>

<script>
  window.onload = function() { //HTMLを読み込んでからscriptを読み込む
    $(".member_index_tbody_td").on('click', function() {
      window.location = $(this).data("href");
    });
  }
</script>